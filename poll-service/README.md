# ğŸ—³ï¸ Poll Service

A standalone microservice responsible for managing polls in the **alx-project-nexus** microservices ecosystem. This service handles poll creation, updates, scheduling, option management, and lifecycle transitions. It exposes a clean FastAPI-based REST API and integrates with an event-driven system for inter-service communication.

---

## ğŸ“˜ Overview

The **Poll Service** is responsible for **authoring and managing polls**, not counting votes or computing results. It acts as the authoritative source for poll metadata and settings.

### Core Responsibilities

* Create polls
* Add/edit poll options
* Manage poll status (draft â†’ active â†’ closed)
* Poll scheduling (start/end times)
* Validate poll configuration
* Publish poll-related events
* Serve poll metadata to other services

It does **not** handle:

* Vote submission â†’ handled by `vote-service`
* Result aggregation â†’ handled by `results-service`
* Authentication â†’ handled by `auth-service`

---

## ğŸ› Architecture

The Poll Service follows a clean architecture broken into:

### **1. API Layer**

* FastAPI routers (`/polls`)
* Request/response validation via Pydantic schemas

### **2. Domain / Services Layer**

* PollService class encapsulating business logic
* Validation (e.g., poll end_time > start_time)

### **3. Data Layer**

* SQLModel models for Poll and PollOption
* PostgreSQL for relational storage
* Database session handling

### **4. Events Layer (Optional)**

* Event producers to publish domain events:

  * `Poll.Created`
  * `Poll.Updated`
  * `Poll.Started`
  * `Poll.Closed`

---

## ğŸ“‚ Project Structure

```
poll-service/
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ database.py
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ poll.py
â”‚   â”‚   â””â”€â”€ option.py
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ poll.py
â”‚   â”‚   â””â”€â”€ option.py
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â””â”€â”€ polls.py
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ poll_service.py
â”‚   â”œâ”€â”€ events/
â”‚   â”‚   â”œâ”€â”€ producer.py
â”‚   â”‚   â””â”€â”€ contracts.py
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ time.py
â”‚
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_polls.py
â”‚
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

---

## ğŸ—ƒ Database Schema

### Poll Table

| Column            | Type      | Description                   |
| ----------------- | --------- | ----------------------------- |
| poll_id           | UUID      | Primary Key                   |
| title             | TEXT      | Poll title                    |
| description       | TEXT      | Poll description              |
| author_id         | UUID      | Owner of the poll             |
| type              | ENUM      | single/multiple/ranked        |
| start_time        | TIMESTAMP | When the poll becomes active  |
| end_time          | TIMESTAMP | When the poll closes          |
| status            | ENUM      | draft/scheduled/active/closed |
| allow_anonymous   | BOOL      | Poll allows anon voters       |
| allow_change_vote | BOOL      | User can change vote          |
| max_choices       | INT       | For multi-choice polls        |
| created_at        | TIMESTAMP | Autogenerated                 |
| updated_at        | TIMESTAMP | Autogenerated                 |

### PollOption Table

| Column     | Type      | Description         |
| ---------- | --------- | ------------------- |
| option_id  | UUID      | Primary Key         |
| poll_id    | UUID      | Foreign key to poll |
| text       | TEXT      | Option label        |
| order      | INT       | Display order       |
| created_at | TIMESTAMP | Autogenerated       |

---

## ğŸš€ API Endpoints

Root path: `/polls`

### Create Poll

`POST /polls/`

```json
{
  "title": "Best Programming Language?",
  "description": "Pick one",
  "type": "single",
  "options": ["Python", "Rust", "Go"],
  "start_time": "2025-10-10T12:00:00",
  "end_time": "2025-10-11T12:00:00",
  "allow_anonymous": true,
  "allow_change_vote": false
}
```

### Get Poll

`GET /polls/{poll_id}`

### List Polls

`GET /polls?author_id={uuid}&status=active`

### Update Poll

`PATCH /polls/{poll_id}`

### Add Poll Option

`POST /polls/{poll_id}/options`

### Change Poll Status

`POST /polls/{poll_id}/status`

```json
{ "status": "active" }
```

---

## ğŸ“¡ Events Emitted

All poll lifecycle changes trigger events. Example structure:

```json
{
  "event_type": "Poll.Created",
  "event_id": "uuid",
  "timestamp": "ISO8601",
  "payload": {
    "poll_id": "uuid",
    "title": "string",
    "author_id": "uuid"
  }
}
```

### Event Types

* `Poll.Created`
* `Poll.Updated`
* `Poll.Started`
* `Poll.Closed`

These events are consumed by:

* vote-service
* results-service
* notification-service
* analytics service

---

## âš™ï¸ Configuration

Environment variables:

```
DATABASE_URL=
SERVICE_PORT=
BROKER_URL=
LOG_LEVEL=
```

---

## ğŸ³ Docker Support

### Build Image

```bash
docker build -t poll-service .
```

### Run Service

```bash
docker run -p 8001:8001 poll-service
```

---

## ğŸ§ª Testing

Run all tests:

```bash
pytest -q
```

---

## Roadmap

* Add poll categories/tags
* Add password-protected polls
* Add image upload for poll options
* Add admin moderation flows
* Improve scheduling with async workers
* Add caching for popular polls

---

## Contribution Guidelines

* Follow the repo coding style
* Use feature branches
* Write tests for new features
* Open a PR with description and screenshots

---

## Support

For questions or issues open a GitHub issue in the main repository.
